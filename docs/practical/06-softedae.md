---
title: Soft-Edge 线稿上色
toc: content
order: 6
group:
  title: 实战
---

# 🎨 动漫线稿转彩色插画

## 一、工作流概述
本工作流实现**手绘动漫线稿到高质量彩色插画**的自动化生成，核心通过 **ControlNet Soft-Edge 模型** 约束原始线稿的柔和轮廓与笔触细节，结合 AnythingXL 动漫大模型与动漫专用 VAE，生成色彩鲜艳、保留线稿结构的动漫风格插画。

---

## 二、节点功能与配置详解
### 🔹 基础模型加载模块
| 节点名称               | 核心作用                                                                 | 关键配置                     |
|------------------------|--------------------------------------------------------------------------|------------------------------|
| Checkpoint加载器（简易） | 加载动漫风格大模型，提供生成所需的基础模型、CLIP 编码器和默认 VAE | 模型：`AnythingXL_v5.0-动漫` |
| 加载VAE                | 加载动漫优化专用 VAE，提升色彩还原度与人物面部细节表现力 | VAE：`kl-f8-anime2-vae-动漫优化` |

---

### 🔹 文本提示词编码模块
| 节点名称               | 核心作用                                                                 | 配置内容                     |
|------------------------|--------------------------------------------------------------------------|------------------------------|
| CLIP文本编码（正向）| 将自然语言提示词编码为模型可理解的向量，引导图像生成方向 | 提示词：<br>`Masterpiece, high definition, 1 girl, white hair, golden eyes, background of a large forest, anime style` |
| CLIP文本编码（负向）| 编码负向提示词，抑制低质量或不符合需求的生成结果 | 提示词：`negative`（可扩展为 `low quality, blurry, ugly` 等） |

---

### 🔹 线稿预处理模块
| 节点名称               | 核心作用                                                                 | 关键参数                     |
|------------------------|--------------------------------------------------------------------------|------------------------------|
| 加载图像 | 输入原始手绘线稿图像（支持本地文件上传） | 图像：`demo1.png` |
| Standard Lineart | 强化线稿的对比度与清晰度，生成标准化线条掩码 | `guassian_sigma=6.00`、`intensity_threshold=8`、`resolution=512` |
| HED Soft-Edge Lines | 生成软边缘线稿掩码，保留原始线稿的柔和笔触与过渡细节 | `resolution=512` |
| 预览图像 | 实时查看 HED 软边缘处理后的线稿效果，便于参数调整 | - |

---

### 🔹 ControlNet 约束模块
| 节点名称               | 核心作用                                                                 | 关键配置                     |
|------------------------|--------------------------------------------------------------------------|------------------------------|
| 加载ControlNet模型 | 加载 Soft-Edge 专用 ControlNet 模型，用于约束线稿的柔和轮廓 | 模型：`SD15/control_v11p_sd15_softedge` |
| 应用ControlNet（旧版高级） | 将 Soft-Edge 线稿约束与文本条件结合，控制生成过程的结构一致性 | `强度=1.00`、`开始百分比=0.000`、`结束百分比=1.000` |

---

### 🔹 图像生成与输出模块
| 节点名称               | 核心作用                                                                 | 关键配置                     |
|------------------------|--------------------------------------------------------------------------|------------------------------|
| 空Latent图像 | 生成初始潜在图像（生成流程的“画布”基础） | `宽度=512`、`高度=512`、`批量大小=1` |
| K采样器 | 执行扩散采样算法，结合所有条件生成潜在图像 | 种子：`511827091800714`（支持随机化）<br>步骤：`25`、CFG：`6.5`<br>采样器：`dpmpp_2m`、调度器：`karras`<br>降噪：`1.00` |
| VAE解码 | 将潜在图像解码为可视化的 RGB 图像 | - |
| 保存图像 | 将生成的图像保存到本地，支持自定义文件名前缀 | 文件名前缀：`ComfyUI` |

---

## 三、重点解析：Soft-Edge ControlNet 模型
### ✨ 模型简介
- **全称**：`control_v11p_sd15_softedge`
- **核心原理**：基于 HED（Holistically-Nested Edge Detection）算法，检测图像中的**柔和边缘与渐变轮廓**，生成保留笔触质感的软边缘掩码，避免硬边缘模型的生硬感。

### 🎯 与其他线稿模型的区别
| 模型类型   | 特点                     | 适用场景               |
|------------|--------------------------|------------------------|
| Soft-Edge | 保留柔和笔触与渐变细节，边缘自然过渡 | 手绘动漫线稿、插画轮廓 |
| Canny     | 生成高对比度硬边缘，线条锐利 | 机械、建筑等硬结构线稿 |
| Lineart   | 提取纯黑白线条，强化轮廓 | 极简线稿、漫画分镜     |

### 🛠️ 在本工作流中的作用
Soft-Edge 模型能精准保留原始动漫线稿的**手绘笔触、发丝渐变与衣物褶皱的柔和过渡**，避免生成的彩色插画线条过于僵硬，让最终画面更贴近手绘质感。

---

## 四、工作流执行逻辑
1.  **初始化加载**：加载大模型、Soft-Edge ControlNet 模型和动漫专用 VAE。
2.  **提示词编码**：正向/负向提示词经 CLIP 编码为模型可理解的向量。
3.  **线稿预处理**：原始线稿经 `Standard Lineart` 和 `HED Soft-Edge Lines` 处理，生成柔和边缘掩码。
4.  **ControlNet 约束注入**：在扩散采样过程中，Soft-Edge 掩码强制模型保留线稿的柔和轮廓。
5.  **扩散生成解码**：K 采样器生成潜在图像，经专用 VAE 解码为可视化插画。
6.  **结果输出**：生成的图像保存并展示。

---

## 五、参数优化建议
- **ControlNet 强度**：若线稿约束过强（画面僵硬），可降低至 `0.7-0.9`；若约束不足（线稿变形），可提高至 `1.0-1.2`。
- **HED 线稿参数**：`guassian_sigma` 越大，边缘越柔和；`intensity_threshold` 越高，线条越清晰。
- **采样器配置**：动漫风格推荐 `dpmpp_2m` 采样器，`20-30` 步即可平衡质量与速度；追求极致画质可增加至 `30-40` 步。

---
