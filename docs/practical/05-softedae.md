---
title: Soft-Edge 线稿上色
toc: content
order: 5
group:
  title: 实战
---

# 🎨 动漫线稿转彩色插画

## 一、工作流概述

本工作流实现**手绘动漫线稿到高质量彩色插画**的自动化生成，核心通过 **ControlNet Soft-Edge 模型** 约束原始线稿的柔和轮廓与笔触细节，结合 AnythingXL 动漫大模型与动漫专用 VAE，生成色彩鲜艳、保留线稿结构的动漫风格插画。

![图片](/comfyui-doc/practical/img/softedae.png)
[softedge 下载示例文件(JSON)](/practical/json/softedae.json)
<br />
[linear 下载示例文件(JSON)](/practical/json/linear.json)

---

## 二、节点功能与配置详解

### 🔹 基础模型加载模块

| 节点名称                  | 核心作用                                                          | 关键配置                         |
| ------------------------- | ----------------------------------------------------------------- | -------------------------------- |
| Checkpoint 加载器（简易） | 加载动漫风格大模型，提供生成所需的基础模型、CLIP 编码器和默认 VAE | 模型：`AnythingXL_v5.0-动漫`     |
| 加载 VAE                  | 加载动漫优化专用 VAE，提升色彩还原度与人物面部细节表现力          | VAE：`kl-f8-anime2-vae-动漫优化` |

---

### 🔹 文本提示词编码模块

| 节点名称              | 核心作用                                                 | 配置内容                                                                                                               |
| --------------------- | -------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------- |
| CLIP 文本编码（正向） | 将自然语言提示词编码为模型可理解的向量，引导图像生成方向 | 提示词：<br>`Masterpiece, high definition, 1 girl, white hair, golden eyes, background of a large forest, anime style` |
| CLIP 文本编码（负向） | 编码负向提示词，抑制低质量或不符合需求的生成结果         | 提示词：`negative`（可扩展为 `low quality, blurry, ugly` 等）                                                          |

---

### 🔹 线稿预处理模块

| 节点名称            | 核心作用                                             | 关键参数                                                         |
| ------------------- | ---------------------------------------------------- | ---------------------------------------------------------------- |
| 加载图像            | 输入原始手绘线稿图像（支持本地文件上传）             | 图像：`demo1.png`                                                |
| Standard Lineart    | 强化线稿的对比度与清晰度，生成标准化线条掩码         | `guassian_sigma=6.00`、`intensity_threshold=8`、`resolution=512` |
| HED Soft-Edge Lines | 生成软边缘线稿掩码，保留原始线稿的柔和笔触与过渡细节 | `resolution=512`                                                 |
| 预览图像            | 实时查看 HED 软边缘处理后的线稿效果，便于参数调整    | -                                                                |

---

### 🔹 ControlNet 约束模块

| 节点名称                    | 核心作用                                                      | 关键配置                                            |
| --------------------------- | ------------------------------------------------------------- | --------------------------------------------------- |
| 加载 ControlNet 模型        | 加载 Soft-Edge 专用 ControlNet 模型，用于约束线稿的柔和轮廓   | 模型：`SD15/control_v11p_sd15_softedge`             |
| 应用 ControlNet（旧版高级） | 将 Soft-Edge 线稿约束与文本条件结合，控制生成过程的结构一致性 | `强度=1.00`、`开始百分比=0.000`、`结束百分比=1.000` |

---

### 🔹 图像生成与输出模块

| 节点名称       | 核心作用                                     | 关键配置                                                                                                                |
| -------------- | -------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------- |
| 空 Latent 图像 | 生成初始潜在图像（生成流程的“画布”基础）     | `宽度=512`、`高度=512`、`批量大小=1`                                                                                    |
| K 采样器       | 执行扩散采样算法，结合所有条件生成潜在图像   | 种子：`511827091800714`（支持随机化）<br>步骤：`25`、CFG：`6.5`<br>采样器：`dpmpp_2m`、调度器：`karras`<br>降噪：`1.00` |
| VAE 解码       | 将潜在图像解码为可视化的 RGB 图像            | -                                                                                                                       |
| 保存图像       | 将生成的图像保存到本地，支持自定义文件名前缀 | 文件名前缀：`ComfyUI`                                                                                                   |

---

## 三、重点解析：Soft-Edge ControlNet 模型

### ✨ 模型简介

- **全称**：`control_v11p_sd15_softedge`
- **核心原理**：基于 HED（Holistically-Nested Edge Detection）算法，检测图像中的**柔和边缘与渐变轮廓**，生成保留笔触质感的软边缘掩码，避免硬边缘模型的生硬感。

### 核心依赖模型

| 模型类型               | 模型名称                                | 存放目录                      |
| ---------------------- | --------------------------------------- | ----------------------------- |
| Checkpoint（主模型）   | `AnythingXL_v50-动漫.safetensors`       | `ComfyUI/models/checkpoints/` |
| ControlNet（控制模型） | `SD1.5/control_v11p_sd15_softedge`      | `ComfyUI/models/controlnet/`  |
| VAE（优化模型）        | `ka-f8-anime2-vae-动漫优化.safetensors` | `ComfyUI/models/vae/`         |

### 🎯 与其他线稿模型的区别

| 模型类型  | 特点                                 | 适用场景               | 模型                        |
| --------- | ------------------------------------ | ---------------------- | --------------------------- |
| Soft-Edge | 保留柔和笔触与渐变细节，边缘自然过渡 | 手绘动漫线稿、插画轮廓 | control_v11p_sd15_softedge  |
| Canny     | 生成高对比度硬边缘，线条锐利         | 机械、建筑等硬结构线稿 | 不推荐使用                  |
| Lineart   | 提取纯黑白线条，强化轮廓             | 极简线稿、漫画分镜     | control_v11p_sd15s2_lineart |

### 🛠️ 在本工作流中的作用

Soft-Edge 模型能精准保留原始动漫线稿的**手绘笔触、发丝渐变与衣物褶皱的柔和过渡**，避免生成的彩色插画线条过于僵硬，让最终画面更贴近手绘质感。

---

## 四、工作流完整逻辑

1.  **输入层**：加载生成模型、线稿素材和文本提示词，完成基础准备。
2.  **预处理层**：强化线稿边缘特征，生成清晰的控制轮廓。
3.  **控制层**：通过 ControlNet 将线稿约束注入生成流程，确保轮廓精准。
4.  **生成层**：K 采样器结合模型、文本条件和线稿控制，生成潜空间张量。
5.  **解码层**：用优化 VAE 将张量转换为高质量可视化图像。
6.  **输出层**：保存生成的最终插画。

---

## 五、参数优化建议

- **ControlNet 强度**：若线稿约束过强（画面僵硬），可降低至 `0.7-0.9`；若约束不足（线稿变形），可提高至 `1.0-1.2`。
- **HED 线稿参数**：`guassian_sigma` 越大，边缘越柔和；`intensity_threshold` 越高，线条越清晰。
- **采样器配置**：动漫风格推荐 `dpmpp_2m` 采样器，`20-30` 步即可平衡质量与速度；追求极致画质可增加至 `30-40` 步。

---
